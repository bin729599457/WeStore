<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 设置为OrderDAO接口方法提供sql语句配置 -->
<mapper namespace="com.westore.dao.OrderDAO">

    <select id="findOrders" parameterType="java.util.Map" resultType="java.util.Map">

        SELECT t.id as order_id,t.user_id as user_id,t.total_money,t.order_date,t.order_state,td.goods_num,tg.goods_title,tg.goods_price
        FROM t_b_order t,t_b_order_detail td,t_b_goods tg
        WHERE 1=1
        AND t.id=td.order_id
        AND td.goods_id=tg.id

        <if test="order_date!=null  and order_date!=''">
            AND t.order_date >=to_date(#{order_start_date},'yyyy-mm-dd')
        </if>
        <if test="order_date !=null  and order_date !=''">
            AND t.order_date &lt;=to_date(#{order_over_date},'yyyy-mm-dd')
        </if>
        <if test="id!=null and id!=''">
            AND t.id=#{id}
        </if>
        <if test="user_id!=null and user_id!=''">
            AND t.user_id=#{user_id}
        </if>

    </select>

    <insert id="addOrder" parameterType="java.util.Map">
        insert into t_b_order (id,user_id,total_money,order_date,order_state) values
        (#{id},#{user_id},#{total_money},#{order_date},#{order_state})
    </insert>

    <delete id="deleteOrder" parameterType="java.util.Map">
      DELETE FROM t_b_order WHERE id=#{id}
    </delete>

    <update id="updateGoods" parameterType="java.util.Map">
        UPDATE t_b_goods
        <trim prefix="set" suffixOverrides=",">

            <if test="order_state!=null and order_state!=''">
                order_state=#{order_state},
            </if>
        </trim>

        WHERE id=#{id}
    </update>

</mapper>